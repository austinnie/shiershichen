// 十二时辰预兆解释数据
const OMEN_DATA  = {
    "占焚炉法": {
        "子时": "祖师临坛，求卜大吉",
        "丑时": "口舌是非，烦闷之事",
        "寅时": "主得大财，阴人大吉",
        "卯时": "有远客至，交会事吉",
        "辰时": "有争讼事，失财不利",
        "巳时": "音讯远至，财利大吉",
        "午时": "不顺心事，耗财烦恼",
        "未时": "贵人青睐，竭大吉昌",
        "申时": "有得官事，财帛大吉",
        "酉时": "有争执事，疾病怪事",
        "戌时": "钱物耗失，祸事临身",
        "亥时": "凡事不顺，伤灾火灾"
    },
    "占面热法": {
        "子时": "主喜庆事，又主得财",
        "丑时": "主有烦恼，忧虑之事",
        "寅时": "主有客来，聚会大吉",
        "卯时": "主有酒食及外人至",
        "辰时": "主有远客，喜相逢吉",
        "巳时": "主有急事，人来相见",
        "午时": "主亲来相见，命同坐",
        "未时": "主有词讼，口舌是非",
        "申时": "主有高人，会道相见",
        "酉时": "主有高人来相见",
        "戌时": "主有酒食，不叫自来",
        "亥时": "主官讼及不宁之事"
    },
    "占眼跳法": {
        "子时": {"左": "有贵人", "右": "有酒食"},
        "丑时": {"左": "有忧疑", "右": "有人悲"},
        "寅时": {"左": "远人来", "右": "喜庆事"},
        "卯时": {"左": "贵人来", "右": "平和吉"},
        "辰时": {"左": "客从来", "右": "损害事"},
        "巳时": {"左": "主酒事", "右": "主凶事"},
        "午时": {"左": "主饮食", "右": "主凶事"},
        "未时": {"左": "主有吉昌", "右": "主小喜"},
        "申时": {"左": "有财利", "右": "有友思"},
        "酉时": {"左": "有客至", "右": "主亲来"},
        "戌时": {"左": "主酒食", "右": "主聚财"},
        "亥时": {"左": "主有客", "右": "主官事"}
    },
    "占眼润法": {
        "子时": {"左": "主财喜", "右": "生烦恼"},
        "丑时": {"左": "主得财", "右": "主人思"},
        "寅时": {"左": "奴婢事", "右": "有喜事"},
        "卯时": {"左": "有惊事", "右": "有相骂"},
        "辰时": {"左": "有喜事", "右": "得财物"},
        "巳时": {"左": "贵客至", "右": "口舌事"},
        "午时": {"左": "有酒食", "右": "有恶事"},
        "未时": {"左": "有饮食", "右": "大吉事"},
        "申时": {"左": "远行事", "右": "有客来"},
        "酉时": {"左": "有饮食", "右": "有相争"},
        "戌时": {"左": "有口舌", "右": "有喜庆"},
        "亥时": {"左": "有远行", "右": "有女灾"}
    },
    "占耳热法": {
        "子时": "主有僧道来相议事",
        "丑时": "主有喜事临身，大吉",
        "寅时": "主有酒食相会，大吉",
        "卯时": "主有远人来相见，吉",
        "辰时": "主有财吉，人通达吉",
        "巳时": "主失财物之事，不利",
        "午时": "主有喜气事来，大吉",
        "未时": "主有客至相求之事",
        "申时": "主有酒食宴乐事，吉",
        "酉时": "主有女子至，婚姻事",
        "戌时": "主争讼口舌之事",
        "亥时": "主有口舌词讼之事"
    },
    "占耳鸣法": {
        "子时": {"左": "主友思", "右": "主失财"},
        "丑时": {"左": "主口舌", "右": "主争讼"},
        "寅时": {"左": "主失财", "右": "主心急"},
        "卯时": {"左": "主坎坷", "右": "主客至"},
        "辰时": {"左": "主远行", "右": "主客至"},
        "巳时": {"左": "主凶事", "右": "主大吉"},
        "午时": {"左": "主远信", "右": "主亲来"},
        "未时": {"左": "主饮食", "右": "主人来"},
        "申时": {"左": "主行人", "右": "主大吉"},
        "酉时": {"左": "主失财", "右": "主大吉"},
        "戌时": {"左": "主酒食", "右": "主客至"},
        "亥时": {"左": "主大吉", "右": "主酒食"}
    },
    "占耳痒法": {
        "子时": {"左": "主友思", "右": "主失财"},
        "丑时": {"左": "主口舌", "右": "主争讼"},
        "寅时": {"左": "主失财", "右": "主心急"},
        "卯时": {"左": "主坎坷", "右": "主客至"},
        "辰时": {"左": "主远行", "右": "主客至"},
        "巳时": {"左": "主凶事", "右": "主大吉"},
        "午时": {"左": "主远信", "右": "主亲来"},
        "未时": {"左": "主饮食", "右": "主人来"},
        "申时": {"左": "主行人", "右": "主大吉"},
        "酉时": {"左": "主失财", "右": "主大吉"},
        "戌时": {"左": "主酒食", "右": "主客至"},
        "亥时": {"左": "主大吉", "右": "主酒食"}
    },
    "占喷嚏法": {
        "子时": "主逢吉人，酒食相会",
        "丑时": "情人默思，客人求事",
        "寅时": "主男女相遇，有酒食",
        "卯时": "主财喜有客来，同事",
        "辰时": "主人有酒食，大吉利",
        "巳时": "主有吉人来求财，喜",
        "午时": "主有客旅，酒会宴饮",
        "未时": "主酒食相会合之事",
        "申时": "夜梦惊恐，酒食不利",
        "酉时": "主阴人来求请问事",
        "戌时": "主情人思会和合事",
        "亥时": "主有虚惊，反得吉利"
    },
    "占心惊法": {
        "子时": "主有情子思喜事至",
        "丑时": "主有恶事临门则凶",
        "寅时": "主有客来，饮食大吉",
        "卯时": "主有酒食事，外人来",
        "辰时": "主成名喜事，大吉利",
        "巳时": "主情人思，多喜事至",
        "午时": "主有酒食自来，大吉",
        "未时": "主有情人思念，大吉",
        "申时": "主有大喜之事，吉利",
        "酉时": "主有喜信至，大吉庆",
        "戌时": "主有贵人即至，大吉",
        "亥时": "主有恶人，占身大凶"
    },
    "占肉颤法": {
        "子时": "主有尊长人来，大吉",
        "丑时": "主有吉祥临身，大吉",
        "寅时": "主有凶事，化凶为吉",
        "卯时": "主有得财事，大吉利",
        "辰时": "主凶恶临身，大凶",
        "巳时": "主宾友相见，大吉利",
        "午时": "主有忧疑事，自身吉",
        "未时": "主有喜事，占身大吉",
        "申时": "主有口舌，解之则吉",
        "酉时": "主因财起祸事，大凶",
        "戌时": "主有行人远来，大吉",
        "亥时": "主有大吉利，喜庆之事"
    },
    "占手痒法": {
        "子时": "得饮食，酒会之事吉",
        "丑时": "有贵人来，情人相思",
        "寅时": "有忧思之事，烦恼",
        "卯时": "君子来回之事，吉",
        "辰时": "有客来，合作事大利",
        "巳时": "有思念儿子消息事",
        "午时": "有妻之事，相请之事",
        "未时": "有爱念相思之事，财吉",
        "申时": "有远行这事，有财来",
        "酉时": "有进退事，小心则吉",
        "戌时": "有县官口舌之事",
        "亥时": "有远行这事，忧愁"
    },
    "占足痒法": {
        "子时": "有远客来，恶事将至",
        "丑时": "有市贾事，财利顺吉",
        "寅时": "有人骂之口舌是非",
        "卯时": "有贵之事，求财大吉",
        "辰时": "有恨之意，或有恶事",
        "巳时": "有喜事，情人相思事",
        "午时": "有人呼情之事，顺吉",
        "未时": "有好事酒食相顾之",
        "申时": "有远行事，烦累苦心",
        "酉时": "有男女事，合之吉祥",
        "戌时": "有酒肉事，对坐争强",
        "亥时": "有酒肉事，对坐而吉"
    },
    "占踢足法": {
        "子时": {"左": "异性相思，是非口舌", "右": "有酒食事，有亲相问"},
        "丑时": {"左": "损害伤财，争讼不吉", "右": "伤害之事，吉事平和"},
        "寅时": {"左": "远客至，一日白忙", "右": "饮食之事，有女相思"},
        "卯时": {"左": "有掌权事，口舌烦恼", "右": "不客远至，口舌是非"},
        "辰时": {"左": "有忧愁事，得财之喜", "右": "遇小人害，开心聚财"},
        "巳时": {"左": "贵人相及，合会之喜", "右": "得财相投，好事成双"}
    },
    "占衣留法": {
        "子时": {"男": "酒食", "女": "亲事"},
        "丑时": "主有忧思破财之事",
        "寅时": "望夫进财昌，大吉利",
        "卯时": "主酒食、交友、同会吉",
        "辰时": "主自失财、忧灾、疾病",
        "巳时": {"女": "外心", "男": "无凶事"},
        "午时": "主远人至，得利、大吉",
        "未时": "血光之灾，化凶为吉",
        "申时": "主得外财，出入大吉",
        "酉时": "主有客至，破财、不利",
        "戌时": "主词讼，得财、大吉",
        "亥时": "主有喜事，得财、大吉"
    },
    "占火逸法": {
        "子时": "妻有外心，烦闷之事",
        "丑时": "女心向外，大不吉利",
        "寅时": "得小喜、平安大吉利",
        "卯时": "主得财帛，享通之兆",
        "辰时": "主忧心，损男小口，灾",
        "巳时": "主有喜事，酒食相逢",
        "午时": "有相争见官、火灾事",
        "未时": "主得财喜昌盛之兆",
        "申时": "主得财帛，会合事，吉",
        "酉时": "主有凶事，豹变之兆",
        "戌时": "主忧心，见得理之兆",
        "亥时": "主身疾病，妨害之兆"
    },
    "占斧鸣法": {
        "子时": "主六畜平安，大吉利",
        "丑时": "主家宅定，富贵，大吉",
        "寅时": "主家宅凶，怪事，大凶",
        "卯时": "主家们祸事至，大凶",
        "辰时": "主宜田蚕，有利，大吉",
        "巳时": "有福至财来，大吉",
        "午时": "主官事消散，大吉昌",
        "未时": "主有凶祸之事，不利",
        "申时": "主远人来，昌盛，大吉",
        "酉时": "主远行人来，大吉利",
        "戌时": "主有小喜，享通，大吉",
        "亥时": "主官事有理，大吉昌"
    },
    "占断甲法": {
        "子时": "有不尽意事，财上吉祥",
        "丑时": "有合作事，喜事临身",
        "寅时": "有耗财之事，音信吉",
        "卯时": "有酒食事，远客至",
        "辰时": "老情人相思，又主音信",
        "巳时": "有朋友相托事，主吉",
        "午时": "事有虚惊，会朋友吉",
        "未时": "有不如意事，吉庆祥和",
        "申时": "有欢喜事，有小人碍障",
        "酉时": "有和合事，则上见喜",
        "戌时": "有忧疑事，解之则吉",
        "亥时": "事有不吉，财上有失"
    },
    "占鹊噪法": {
        "子时": "主有远亲人至，大吉",
        "丑时": "主有喜庆之事，大吉",
        "寅时": "主有词讼之事，小吉",
        "卯时": "主有酒食财喜，大吉",
        "辰时": "主有远行人至家，吉",
        "巳时": "主有喜事降临，大吉",
        "午时": "主有疾病，求神安，吉",
        "未时": "主有六畜不见之事",
        "申时": "主有喜庆事，大吉昌",
        "酉时": "主有坎坷，不宁之事",
        "戌时": "主有财帛享通，大吉",
        "亥时": "主有口舌争斗之事"
    },
    "占犬嚎法": {
        "子时": "主有妇人不时之争",
        "丑时": "主有忧闷忧心之事",
        "寅时": "在上进财，昌，大吉利",
        "卯时": "在上必得财，大吉",
        "辰时": "主喜事至，大享通，吉",
        "巳时": "主有亲人相会，信至",
        "午时": "主逢酒食宴会，大吉",
        "未时": "主有家中内外破财",
        "申时": "主家宅有小口之忧",
        "酉时": "加官进禄，必定得财",
        "戌时": "主有口舌之事，大凶",
        "亥时": "主有官非词讼之事"
    }
};

// 增强版预兆查询函数
function getOmenInfo(omenType, timePeriod, side = null, gender = null) {
    if (!OMEN_DATA[omenType]) {
        return "未知的预兆类型";
    }

    const timeData = OMEN_DATA[omenType][timePeriod];
    if (!timeData) {
        return "未知的时辰";
    }

    // 处理字符串类型预兆（如占衣留法的部分时辰）
    if (typeof timeData === 'string') {
        return timeData;
    }

    // 处理对象类型预兆
    if (typeof timeData === 'object') {
        // 优先处理性别选择
        if (gender && timeData[gender]) {
            return timeData[gender];
        }
        // 其次处理左右侧选择
        if (side && timeData[side]) {
            return timeData[side];
        }
        // 默认返回所有可能选项
        const results = [];
        for (const key in timeData) {
            results.push(`${key}: ${timeData[key]}`);
        }
        return results.join('；');
    }

    return "预兆数据格式错误";
}

// 判断是否需要性别选择器
function needGenderPicker(omenType, timePeriod) {
    if (omenType !== '占衣留法') return false;
    const timeData = OMEN_DATA[omenType][timePeriod];
    return typeof timeData === 'object' && ('男' in timeData || '女' in timeData);
}

// 判断是否需要侧别选择器
function needSidePicker(omenType) {
    const sideOmenTypes = [
        '占眼跳法', '占眼润法', 
        '占耳鸣法', '占耳痒法', 
        '占踢足法'
    ];
    return sideOmenTypes.includes(omenType);
}

// 获取所有预兆类型（保持不变）
function getOmenTypes() {
    return Object.keys(OMEN_DATA).map((key, index) => ({
        id: index + 1,
        name: key
    }));
}

module.exports = {
    getOmenInfo,
    getOmenTypes,
    needGenderPicker,
    needSidePicker
};
